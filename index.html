<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Property Carousel</title>

<style>
/* ================= RESET ================= */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: Arial, sans-serif;
  overflow-x: hidden;
}

/* ================= CAROUSEL ================= */
.carousel {
  position: relative;
  width: 100%;
  overflow: hidden;
  padding: 40px 0;
}

.carousel-track {
  display: flex;
  gap: 20px;
  will-change: transform;
}

.carousel-item {
  min-width: 80vw;
  height: 400px;
  background-size: cover;
  background-position: center;
  border-radius: 12px;
  flex-shrink: 0;
}

/* ================= COUNTER ================= */
.carousel-counter {
  position: absolute;
  bottom: 10px;
  right: 20px;
  background: rgba(0,0,0,0.6);
  color: #fff;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 14px;
}
</style>
</head>

<body>

<section class="carousel" id="property-gallery">
  <div class="carousel-track">
    <div class="carousel-item" style="background-image:url('https://picsum.photos/1200/800?1')"></div>
    <div class="carousel-item" style="background-image:url('https://picsum.photos/1200/800?2')"></div>
    <div class="carousel-item" style="background-image:url('https://picsum.photos/1200/800?3')"></div>
    <div class="carousel-item" style="background-image:url('https://picsum.photos/1200/800?4')"></div>
  </div>

  <div class="carousel-counter">
    <span class="current">1</span> / <span class="total">4</span>
  </div>
</section>

<script>
/* ================= CONFIG ================= */
window.CAROUSEL_CONFIGS = {
  "property-gallery": {
    loop: true,
    autoplay: true,
    autoplayDelay: 3000
  }
};
</script>

<script>
/* =========================================================
   CAROUSEL ENGINE â€“ Infinite loop with clones
   ========================================================= */
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".carousel").forEach((carousel) => {
    const id = carousel.id;
    const config = window.CAROUSEL_CONFIGS[id] || {};
    const track = carousel.querySelector(".carousel-track");

    let items = Array.from(track.children);
    if (!items.length) return;

    /* ---------- CLONES ---------- */
    if (config.loop && items.length > 1) {
      const first = items[0].cloneNode(true);
      const last = items[items.length - 1].cloneNode(true);
      first.classList.add("clone");
      last.classList.add("clone");
      track.appendChild(first);
      track.insertBefore(last, items[0]);
      items = Array.from(track.children);
    }

    let index = config.loop ? 1 : 0;
    let timer = null;
    let visible = false;

    const counter = carousel.querySelector(".carousel-counter");
    const currentEl = counter.querySelector(".current");
    const totalEl = counter.querySelector(".total");

    const realCount = config.loop ? items.length - 2 : items.length;
    totalEl.textContent = realCount;

    function step() {
      const gap = parseInt(getComputedStyle(track).gap || 0, 10);
      return items[0].offsetWidth + gap;
    }

    function updateCounter() {
      let display = index;
      if (config.loop) {
        if (index === 0) display = realCount;
        else if (index === items.length - 1) display = 1;
      }
      currentEl.textContent = display;
    }

    function goTo(i, animate = true) {
      index = i;
      track.style.transition = animate ? "transform 400ms ease" : "none";
      track.style.transform = `translateX(${-i * step()}px)`;
      updateCounter();
    }

    function next() {
      goTo(index + 1);
    }

    /* ---------- LOOP FIX ---------- */
    track.addEventListener("transitionend", () => {
      if (!config.loop) return;

      if (items[index].classList.contains("clone")) {
        if (index === 0) goTo(items.length - 2, false);
        if (index === items.length - 1) goTo(1, false);
      }
    });

    /* ---------- AUTOPLAY ---------- */
    function start() {
      if (!config.autoplay || timer || !visible) return;
      timer = setInterval(next, config.autoplayDelay || 4000);
    }

    function stop() {
      clearInterval(timer);
      timer = null;
    }

    /* ---------- DRAG / SWIPE ---------- */
    let startX = 0;
    let dragging = false;
    let prevTranslate = 0;
    let currentTranslate = 0;

    function dragStart(e) {
      dragging = true;
      startX = e.type.includes("mouse") ? e.pageX : e.touches[0].clientX;
      prevTranslate = -index * step();
      track.style.transition = "none";
    }

    function dragMove(e) {
      if (!dragging) return;
      const x = e.type.includes("mouse") ? e.pageX : e.touches[0].clientX;
      currentTranslate = prevTranslate + (x - startX);
      track.style.transform = `translateX(${currentTranslate}px)`;
    }

    function dragEnd() {
      if (!dragging) return;
      dragging = false;

      const moved = currentTranslate - prevTranslate;
      if (moved < -step() * 0.2) next();
      else if (moved > step() * 0.2) goTo(index - 1);
      else goTo(index);
    }

    carousel.addEventListener("mousedown", dragStart);
    carousel.addEventListener("mousemove", dragMove);
    carousel.addEventListener("mouseup", dragEnd);
    carousel.addEventListener("mouseleave", dragEnd);
    carousel.addEventListener("touchstart", dragStart, { passive: true });
    carousel.addEventListener("touchmove", dragMove, { passive: true });
    carousel.addEventListener("touchend", dragEnd);

    /* ---------- VISIBILITY ---------- */
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        visible = entry.isIntersecting;
        visible ? start() : stop();
      });
    }, { threshold: 0.3 });

    observer.observe(carousel);

    /* ---------- INIT ---------- */
    goTo(index, false);
    start();
  });
});
</script>

</body>
</html>
